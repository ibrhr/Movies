{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Back link -->
    <div class="mb-6">
        <a href="{{ url_for('movies.detail', movie_id=movie.id) }}" 
           class="inline-flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            Back to {{ movie.title }}
        </a>
    </div>

    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-white mb-6">Edit Your Review</h1>

        <!-- Movie Info Card -->
        <div class="bg-slate-800 rounded-lg border border-slate-700 overflow-hidden mb-6">
            <div class="grid grid-cols-12">
                <div class="col-span-3 md:col-span-2">
                    {% if movie.poster_path %}
                    <img src="https://image.tmdb.org/t/p/w200{{ movie.poster_path }}" 
                         class="w-full h-full object-cover" 
                         alt="{{ movie.title }}">
                    {% else %}
                    <div class="w-full h-full min-h-[150px] bg-slate-700 flex items-center justify-center">
                        <span class="text-slate-400">No Image</span>
                    </div>
                    {% endif %}
                </div>
                <div class="col-span-9 md:col-span-10">
                    <div class="p-6">
                        <h2 class="text-xl font-semibold text-white mb-2">{{ movie.title }}</h2>
                        <p class="text-slate-400">
                            {{ movie.release_date[:4] if movie.release_date else 'N/A' }}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Review Form -->
        <div class="bg-slate-800 rounded-lg border border-slate-700 p-6">
            <form method="POST" action="{{ url_for('movies.edit_review', review_id=review.id) }}" class="space-y-6">
                <!-- Optional Rating -->
                <div>
                    <label for="rating" class="block text-sm font-medium text-slate-300 mb-2">
                        Rating (Optional)
                    </label>
                    <select class="w-full px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                            id="rating" 
                            name="rating">
                        <option value="">No rating</option>
                        {% for i in range(1, 11) %}
                            <option value="{{ i }}" {% if review.rating == i %}selected{% endif %}>
                                {{ i }}/10{% if i >= 8 %} ‚≠ê{% endif %}
                            </option>
                        {% endfor %}
                    </select>
                    <p class="text-sm text-slate-400 mt-1">Give this movie a rating from 1-10, or leave blank.</p>
                </div>

                <!-- Review Text -->
                <div>
                    <label for="review_text" class="block text-sm font-medium text-slate-300 mb-2">
                        Your Review <span class="text-red-400">*</span>
                    </label>
                    <textarea class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                              id="review_text" 
                              name="review_text" 
                              rows="8" 
                              required 
                              minlength="10" 
                              placeholder="Share your thoughts about this movie... (minimum 10 characters)">{{ review.review_text }}</textarea>
                    <p class="text-sm text-slate-400 mt-1">
                        Minimum 10 characters. Be respectful and constructive.
                    </p>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-3">
                    <button type="submit" 
                            class="inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                        <i data-lucide="check" class="w-5 h-5"></i>
                        Update Review
                    </button>
                    <a href="{{ url_for('movies.detail', movie_id=movie.id) }}" 
                       class="inline-flex items-center gap-2 px-6 py-3 bg-slate-700 text-slate-300 border border-slate-600 rounded-lg hover:bg-slate-600 transition-colors font-medium">
                        Cancel
                    </a>
                </div>
            </form>
        </div>

        <!-- Original Post Info -->
        <div class="mt-6 text-sm text-slate-400">
            Originally posted: {{ review.created_at.strftime('%B %d, %Y at %I:%M %p') }}
            {% if review.updated_at and review.updated_at != review.created_at %}
                <br>Last updated: {{ review.updated_at.strftime('%B %d, %Y at %I:%M %p') }}
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
