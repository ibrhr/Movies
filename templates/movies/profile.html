{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        <!-- Left Sidebar -->
        <div class="lg:col-span-4 space-y-6">
            <!-- User Info Card -->
            <div class="bg-slate-800 rounded-lg border border-slate-700 overflow-hidden">
                <div class="bg-blue-900 px-6 py-4 border-b border-slate-700">
                    <h2 class="text-xl font-bold text-white flex items-center gap-2">
                        <i data-lucide="user-circle" class="w-6 h-6"></i>
                        {{ current_user.username }}
                    </h2>
                </div>
                <div class="p-6 space-y-2">
                    <p class="text-slate-300">
                        <span class="font-semibold text-white">Email:</span> {{ current_user.email }}
                    </p>
                    <p class="text-slate-300">
                        <span class="font-semibold text-white">Member since:</span> {{ current_user.created_at.strftime('%B %Y') }}
                    </p>
                </div>
            </div>

            <!-- Stats Card -->
            <div class="bg-slate-800 rounded-lg border border-slate-700 p-6">
                <h3 class="text-xl font-semibold text-white mb-4">Your Stats</h3>
                <div class="border-t border-slate-700 pt-4 mb-4">
                    <div class="grid grid-cols-4 gap-4 text-center">
                        <div>
                            <div class="text-3xl font-bold text-blue-500 mb-1">{{ watched }}</div>
                            <div class="text-xs text-slate-400">Watched</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-emerald-500 mb-1">{{ rated }}</div>
                            <div class="text-xs text-slate-400">Rated</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-red-500 mb-1">{{ watchlist_count }}</div>
                            <div class="text-xs text-slate-400">Watchlist</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold text-slate-400 mb-1">{{ skipped }}</div>
                            <div class="text-xs text-slate-400">Skipped</div>
                        </div>
                    </div>
                </div>
                {% if avg_rating %}
                <div class="border-t border-slate-700 pt-4 text-center">
                    <p class="text-slate-300">
                        <span class="font-semibold text-white">Average Rating:</span> 
                        <span class="text-amber-400 font-bold">{{ "%.1f"|format(avg_rating) }}/10</span>
                    </p>
                </div>
                {% endif %}
            </div>

            <!-- Action Buttons -->
            <div class="space-y-3">
                <a href="{{ url_for('movies.recommendations') }}" 
                   class="flex items-center justify-center gap-2 w-full px-6 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-lg">
                    <i data-lucide="star" class="w-6 h-6"></i>
                    Get Recommendations
                </a>
                <a href="{{ url_for('movies.browse') }}" 
                   class="flex items-center justify-center gap-2 w-full px-6 py-3 bg-slate-700 text-slate-300 border border-slate-600 rounded-lg hover:bg-slate-600 transition-colors font-medium">
                    <i data-lucide="film" class="w-5 h-5"></i>
                    Browse Movies
                </a>
            </div>

            <!-- Security Settings -->
            <div class="bg-slate-800 rounded-lg border border-slate-700 overflow-hidden">
                <div class="bg-slate-700 px-6 py-3 border-b border-slate-600">
                    <h3 class="text-lg font-semibold text-white flex items-center gap-2">
                        <i data-lucide="shield-check" class="w-5 h-5"></i>
                        Security
                    </h3>
                </div>
                <div class="p-4">
                    <a href="{{ url_for('auth.change_password') }}" 
                       class="flex items-center justify-center gap-2 w-full px-4 py-3 bg-slate-700 text-blue-400 border border-blue-600 rounded-lg hover:bg-slate-600 transition-colors font-medium">
                        <i data-lucide="key" class="w-5 h-5"></i>
                        Change Password
                    </a>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="bg-slate-800 rounded-lg border-2 border-red-600 overflow-hidden">
                <div class="bg-red-900 px-6 py-3 border-b border-red-700">
                    <h3 class="text-lg font-semibold text-white flex items-center gap-2">
                        <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                        Danger Zone
                    </h3>
                </div>
                <div class="p-4 space-y-3">
                    <!-- Clear All Data -->
                    <button type="button" 
                            onclick="document.getElementById('clearDataModal').classList.remove('hidden')"
                            class="flex items-center justify-center gap-2 w-full px-4 py-3 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors font-medium">
                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                        Clear All Activity Data
                    </button>
                    
                    <!-- Delete Account -->
                    <button type="button" 
                            onclick="document.getElementById('deleteAccountModal').classList.remove('hidden')"
                            class="flex items-center justify-center gap-2 w-full px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium">
                        <i data-lucide="user-x" class="w-5 h-5"></i>
                        Delete Account
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Content Area -->
        <div class="lg:col-span-8">
            <h2 class="text-3xl font-bold text-white mb-6">Recent Activity</h2>
            {% if recent_interactions %}
            <div class="space-y-3">
                {% for interaction in recent_interactions %}
                <div class="bg-slate-800 rounded-lg border border-slate-700 p-6">
                    <div class="flex justify-between items-start gap-4">
                        <div class="flex-grow">
                            <h3 class="text-lg font-semibold text-white mb-2">
                                <a href="{{ url_for('movies.detail', movie_id=interaction.movie_id) }}" 
                                   class="hover:text-blue-400 transition-colors">
                                    {{ interaction.movie.title }}
                                </a>
                            </h3>
                            <div class="mb-3">
                                {% if interaction.action == 'watch' %}
                                <span class="inline-flex items-center gap-1 px-3 py-1 bg-emerald-600 text-white rounded-md text-sm font-semibold">
                                    Watched
                                </span>
                                {% elif interaction.action == 'rate' %}
                                <span class="inline-flex items-center gap-1 px-3 py-1 bg-blue-600 text-white rounded-md text-sm font-semibold">
                                    Rated {{ interaction.rating }}/10
                                </span>
                                {% elif interaction.action == 'watchlist' %}
                                <span class="inline-flex items-center gap-1 px-3 py-1 bg-red-600 text-white rounded-md text-sm font-semibold">
                                    Added to Watchlist
                                </span>
                                {% elif interaction.action == 'skip' %}
                                <span class="inline-flex items-center gap-1 px-3 py-1 bg-slate-600 text-white rounded-md text-sm font-semibold">
                                    Skipped
                                </span>
                                {% endif %}
                            </div>
                            <p class="text-sm text-slate-400">{{ interaction.timestamp.strftime('%b %d, %Y at %I:%M %p') }}</p>
                        </div>
                        <form method="POST" action="{{ url_for('movies.delete_interaction', interaction_id=interaction.id) }}">
                            <button type="submit" 
                                    onclick="return confirm('Are you sure you want to delete this interaction?')"
                                    class="p-2 bg-slate-700 text-red-400 border border-red-600 rounded-lg hover:bg-red-900/30 transition-colors">
                                <i data-lucide="trash-2" class="w-5 h-5"></i>
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="bg-blue-900/20 border border-blue-800 rounded-lg p-6">
                <p class="text-blue-300">No activity yet. Start watching and rating movies!</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Clear Data Modal -->
<div id="clearDataModal" class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
    <div class="bg-slate-800 rounded-lg max-w-md w-full border border-slate-700">
        <div class="bg-amber-600 px-6 py-4 rounded-t-lg flex justify-between items-center">
            <h3 class="text-xl font-bold text-white flex items-center gap-2">
                <i data-lucide="alert-triangle" class="w-6 h-6"></i>
                Clear All Activity Data
            </h3>
            <button onclick="document.getElementById('clearDataModal').classList.add('hidden')" 
                    class="text-white hover:text-slate-200">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-white font-semibold">Are you sure you want to clear all your activity data?</p>
            <p class="text-slate-300">This will permanently delete:</p>
            <ul class="list-disc list-inside text-slate-300 space-y-1">
                <li>All watched movies ({{ watched }} items)</li>
                <li>All ratings ({{ rated }} items)</li>
                <li>All watchlist items ({{ watchlist_count }} items)</li>
                <li>All skipped movies ({{ skipped }} items)</li>
            </ul>
            <p class="text-red-400 font-semibold">This action cannot be undone!</p>
            <p class="text-slate-400 text-sm">Your account will remain active, but your recommendations will reset.</p>
        </div>
        <div class="px-6 py-4 bg-slate-700/50 rounded-b-lg flex gap-3">
            <button onclick="document.getElementById('clearDataModal').classList.add('hidden')" 
                    class="px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500 transition-colors font-medium">
                Cancel
            </button>
            <form method="POST" action="{{ url_for('movies.clear_all_data') }}" class="flex-1">
                <button type="submit" 
                        class="w-full px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors font-medium flex items-center justify-center gap-2">
                    <i data-lucide="trash-2" class="w-5 h-5"></i>
                    Yes, Clear All Data
                </button>
            </form>
        </div>
    </div>
</div>

<!-- Delete Account Modal -->
<div id="deleteAccountModal" class="hidden fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
    <div class="bg-slate-800 rounded-lg max-w-md w-full border-2 border-red-600">
        <div class="bg-red-600 px-6 py-4 rounded-t-lg flex justify-between items-center">
            <h3 class="text-xl font-bold text-white flex items-center gap-2">
                <i data-lucide="alert-triangle" class="w-6 h-6"></i>
                Delete Account
            </h3>
            <button onclick="document.getElementById('deleteAccountModal').classList.add('hidden')" 
                    class="text-white hover:text-slate-200">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-white font-semibold">Are you sure you want to permanently delete your account?</p>
            <p class="text-slate-300">This will permanently delete:</p>
            <ul class="list-disc list-inside text-slate-300 space-y-1">
                <li>Your account and profile</li>
                <li>All watched movies ({{ watched }} items)</li>
                <li>All ratings ({{ rated }} items)</li>
                <li>All watchlist items ({{ watchlist_count }} items)</li>
                <li>All skipped movies ({{ skipped }} items)</li>
                <li>All preferences and settings</li>
            </ul>
            <p class="text-red-400 font-bold">THIS ACTION CANNOT BE UNDONE!</p>
            <p class="text-slate-400 text-sm">You will be immediately logged out and your account will be permanently removed.</p>
        </div>
        <div class="px-6 py-4 bg-slate-700/50 rounded-b-lg flex gap-3">
            <button onclick="document.getElementById('deleteAccountModal').classList.add('hidden')" 
                    class="px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-500 transition-colors font-medium">
                Cancel
            </button>
            <form method="POST" action="{{ url_for('auth.delete_account') }}" class="flex-1">
                <button type="submit" 
                        class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium flex items-center justify-center gap-2">
                    <i data-lucide="user-x" class="w-5 h-5"></i>
                    Yes, Delete My Account
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
